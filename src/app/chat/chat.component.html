<div [ngClass]="{'dark-theme': darkMode}" class="container">
  <nav class="menu">
    <ul class="items">
      <li (click)="newChat()" class="item">
        <mat-icon>add_circle</mat-icon>
      </li>
      <li (click)="settingsOpen = false"
          [ngClass]="{'item-active': !settingsOpen}"
          class="item item-active">
        <mat-icon>forum</mat-icon>
      </li>
      <li (click)="isDrawerExtended = !isDrawerExtended" class="item">
        <mat-icon *ngIf="!isDrawerExtended">open_in_full</mat-icon>
        <mat-icon *ngIf="isDrawerExtended">close_fullscreen</mat-icon>
      </li>
      <li (click)="settingsOpen = !settingsOpen" [ngClass]="{'item-active': settingsOpen}"
          class="item">
        <mat-icon>settings</mat-icon>
      </li>
    </ul>
  </nav>
  <div *ngIf="isDrawerExtended && !settingsOpen" class="history">
    <div class="history-searchbar">
      <mat-icon class="search-icon">search</mat-icon>
      <input (ngModelChange)="filterHistory($event)" [(ngModel)]="search" name="search" placeholder="Search"
             type="tel">
    </div>
    <div (click)="changeHistoryElement(entry)"
         (keypress)="changeHistoryElement(entry)"
         *ngFor="let entry of historyEntries"
         [ngClass]="{'history-element-active': activeHistoryId === entry.id}"
         class="history-element">
      <div class="history-element-wrapper">
        <p class="testcase">{{ entry.method }}</p>
        <div class="informations">
          <div *ngIf="entry.language"
               class="information-element">{{ entry.language }}
          </div>
          <div class="information-element">{{ formatTimeDifference(entry.created_at) }}</div>
          <div *ngIf="entry.generatedCode"
               class="information-element">GENERATED
          </div>
        </div>
      </div>
      <div class="delete-icon">
        <mat-icon
          (click)="deleteEntry(entry.id)">delete
        </mat-icon>
      </div>


    </div>

  </div>
  <app-settings *ngIf="settingsOpen"></app-settings>
  <div *ngIf="!settingsOpen" class="chat" style="width: 100%; height: 100%; position: relative">
    <div #scrollBottom class="messages-chat">
      <div class="message">
        <div [style.background-image]="'url(' + BOT_LOGO_URL + ')'" class="photo">
          <div class="online"></div>
        </div>
        <p class="text">{{ i18nService.getTranslation(i18n.BOT_INTRODUCTION) }}</p>
      </div>
      <div class="message text-only">
        <p class="text">{{ i18nService.getTranslation(i18n.BOT_LANGUAGE) }}</p>
      </div>
      <div class="message text-only">
        <div class="response">
          <mat-form-field class="text">
            <mat-select [(ngModel)]="input_language_dropdown"
                        [disabled]="!isBefore(this.currentStep, ChatState.USER_SELECT_LANGUAGE)"
                        placeholder="{{ i18nService.getTranslation(i18n.FORM_LANGUAGE) }}">
              <mat-option *ngFor="let language of languages" [value]="language">
                {{ language }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>
      <div *ngIf="isBefore(this.currentStep, ChatState.BOT_MSG_ENTER_VERSION)" class="message">
        <div [style.background-image]="'url(' + BOT_LOGO_URL + ')'"
             class="photo">
          <div class="online"></div>
        </div>
        <p class="text">{{ i18nService.getTranslation(i18n.BOT_VERSION) }}</p>
      </div>
      <div *ngIf="isBefore(this.currentStep, ChatState.USER_SELECT_VERSION)" class="message text-only">
        <div class="response">
          <mat-form-field class="text">
            <mat-select [(ngModel)]="input_version_dropdown"
                        [disabled]="!isBefore(this.currentStep, ChatState.USER_SELECT_VERSION)"
                        placeholder="{{ i18nService.getTranslation(i18n.FORM_VERSION) }}">
              <mat-option *ngFor="let version of versions" [value]="version">
                {{ version }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>
      <div *ngIf="isBefore(this.currentStep, ChatState.BOT_MSG_ENTER_TEST)" class="message">
        <div [style.background-image]="'url(' + BOT_LOGO_URL + ')'"
             class="photo">
          <div class="online"></div>
        </div>
        <p class="text">{{ i18nService.getTranslation(i18n.BOT_TESTCASES) }}</p>
      </div>
      <div *ngIf="isBefore(this.currentStep, ChatState.USER_UPLOAD_TEST)" class="message text-only">
        <div class="response">
          <mat-form-field class="text"
                          style="width: 600px">
            <textarea #autosize="cdkTextareaAutosize"
                      [(ngModel)]="input_test_textarea"
                      [disabled]="!isBefore(this.currentStep, ChatState.USER_UPLOAD_TEST)"
                      cdkAutosizeMaxRows="20"
                      cdkAutosizeMinRows="3"
                      cdkTextareaAutosize
                      matInput></textarea>
          </mat-form-field>
        </div>
      </div>
      <div *ngIf="isBefore(this.currentStep, ChatState.BOT_MSG_UPLOAD_COMPLETED)" class="message">
        <div [style.background-image]="'url(' + BOT_LOGO_URL + ')'"
             class="photo">
          <div class="online"></div>
        </div>
        <p class="text">{{ i18nService.getTranslation(i18n.BOT_TESTCASES_UPLOADED) }}</p>
      </div>
      <div *ngIf="isBefore(this.currentStep, ChatState.BOT_MSG_CONTAINER_STARTED)" class="message text-only">
        <p class="text">{{ i18nService.getTranslation(i18n.BOT_DOCKER_STARTED) }}</p>
      </div>
      <div *ngIf="isBefore(this.currentStep, ChatState.BOT_MSG_GENERATED_CODE)" class="message text-only">
        <pre class="text">
          <code [highlightAuto]="GENERATED_CODE" lineNumbers></code>
        </pre>
        <button (click)="sendCopySnackbar()"
                [cdkCopyToClipboard]="GENERATED_CODE"
                class="copy-btn" mat-fab>
          <mat-icon>content_copy</mat-icon>
        </button>
      </div>
      <div *ngIf="isBefore(this.currentStep, ChatState.BOT_MSG_QUESTION_RETRY)" class="message text-only">
        <p class="text">Möchtest du von weiteren Tests Code generieren?</p>
      </div>
      <div *ngIf="isBefore(this.currentStep, ChatState.USER_QUESTION_RETRY)" class="message text-only">
        <div class="response">
          <mat-radio-group [(ngModel)]="input_new_generation" class="text">
            <mat-radio-button value="true">Ja</mat-radio-button>
            <mat-radio-button value="false">Nein</mat-radio-button>
          </mat-radio-group>
        </div>
      </div>
      <div *ngIf="currentStep == ChatState.BOT_MSG_FINISHED" class="message">
        <div [style.background-image]="'url(' + BOT_LOGO_URL + ')'" class="photo">
          <div class="online"></div>
        </div>
        <p class="text">Danke für das verwenden von Test2Code!</p>
      </div>
    </div>
    <div class="submit-box">
      <button (click)="continue()"
              [disabled]="isSendButtonDisabled()"
              aria-label="Example icon button with a heart icon"
              class="submit-btn"
              mat-fab>
        <mat-icon>send</mat-icon>
      </button>
    </div>
  </div>
</div>
